// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  CLIENT
  ADMIN
  DIRECTION
}

enum BookingStatus {
  PENDING
  CONFIRMED
  ACTIVE
  COMPLETED
  CANCELLED
}

enum VehicleStatus {
  AVAILABLE
  RENTED
  MAINTENANCE
  OUT_OF_SERVICE
}

enum IncidentStatus {
  REPORTED
  IN_PROGRESS
  RESOLVED
  CLOSED
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String
  phone     String?
  address   String?
  role      UserRole @default(CLIENT)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  bookings  Booking[]
  incidents Incident[]
  notifications Notification[]

  @@map("users")
}

model Vehicle {
  id          String        @id @default(uuid())
  brand       String
  model       String
  year        Int
  category    String
  licensePlate String       @unique
  color       String?
  seats       Int
  transmission String
  fuelType    String
  dailyRate   Float
  imageUrl    String?
  status      VehicleStatus @default(AVAILABLE)
  mileage     Int           @default(0)
  stationId   String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  station      Station        @relation(fields: [stationId], references: [id])
  bookings     Booking[]
  maintenances Maintenance[]

  @@map("vehicles")
}

model Station {
  id        String   @id @default(uuid())
  name      String
  city      String
  address   String
  phone     String
  email     String?
  latitude  Float?
  longitude Float?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  vehicles Vehicle[]
  bookings Booking[]

  @@map("stations")
}

model Booking {
  id             String        @id @default(uuid())
  userId         String
  vehicleId      String
  stationId      String
  startDate      DateTime
  endDate        DateTime
  totalPrice     Float
  status         BookingStatus @default(PENDING)
  pickupLocation String?
  dropoffLocation String?
  notes          String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  user     User      @relation(fields: [userId], references: [id])
  vehicle  Vehicle   @relation(fields: [vehicleId], references: [id])
  station  Station   @relation(fields: [stationId], references: [id])
  incidents Incident[]

  @@map("bookings")
}

model Incident {
  id          String         @id @default(uuid())
  bookingId   String
  userId      String
  title       String
  description String
  status      IncidentStatus @default(REPORTED)
  severity    String?
  resolvedAt  DateTime?
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  booking Booking @relation(fields: [bookingId], references: [id])
  user    User    @relation(fields: [userId], references: [id])

  @@map("incidents")
}

model Maintenance {
  id          String   @id @default(uuid())
  vehicleId   String
  type        String
  description String
  cost        Float?
  scheduledAt DateTime
  completedAt DateTime?
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  vehicle Vehicle @relation(fields: [vehicleId], references: [id])

  @@map("maintenances")
}

model Notification {
  id        String   @id @default(uuid())
  userId    String
  title     String
  message   String
  read      Boolean  @default(false)
  type      String?
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])

  @@map("notifications")
}
